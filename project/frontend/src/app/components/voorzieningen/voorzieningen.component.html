<div class="container">
  <div class="header">
    <h1>Voorzieningen</h1>
    @if (isAdmin) {
      <button class="btn-primary" (click)="openCreateForm()">
        + Create New
      </button>
    }
  </div>

  @if (error) {
    <div class="alert alert-error">{{ error }}</div>
  }

  @if (success) {
    <div class="alert alert-success">{{ success }}</div>
  }

  @if (loading && !showForm) {
    <div class="loading">Loading voorzieningen...</div>
  }

  @if (!loading && voorzieningen.length === 0) {
    <div class="card">
      <p>No voorzieningen found. Create your first one!</p>
    </div>
  }

  @if (!loading && voorzieningen.length > 0) {
    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>Naam</th>
            <th>Beschrijving</th>
            <th>Longitude</th>
            <th>Latitude</th>
            <th>Created</th>
            @if (isAdmin) {
              <th>Actions</th>
            }
          </tr>
        </thead>
        <tbody>
          @for (voorziening of voorzieningen; track voorziening.id) {
            <tr>
              <td>{{ voorziening.naam }}</td>
              <td>{{ voorziening.beschrijving }}</td>
              <td>{{ voorziening.longitude | number:'1.4-4' }}</td>
              <td>{{ voorziening.latitude | number:'1.4-4' }}</td>
              <td>{{ voorziening.createdAt | date:'short' }}</td>
              @if (isAdmin) {
                <td class="actions">
                  <button class="btn-sm btn-primary" (click)="openEditForm(voorziening)">
                    Edit
                  </button>
                  <button class="btn-sm btn-danger" (click)="delete(voorziening.id!)">
                    Delete
                  </button>
                </td>
              }
            </tr>
          }
        </tbody>
      </table>
    </div>
  }

  @if (showForm) {
    <div class="modal-backdrop" (click)="closeForm()"></div>
    <div class="modal">
      <div class="modal-header">
        <h2>{{ editMode ? 'Edit' : 'Create' }} Voorziening</h2>
        <button class="close-btn" (click)="closeForm()">&times;</button>
      </div>
      <div class="modal-body">
        <form (ngSubmit)="save()">
          <div class="form-group">
            <label for="naam">Naam *</label>
            <input
              type="text"
              id="naam"
              [(ngModel)]="currentVoorziening.naam"
              name="naam"
              required
            />
          </div>

          <div class="form-group">
            <label for="beschrijving">Beschrijving</label>
            <textarea
              id="beschrijving"
              [(ngModel)]="currentVoorziening.beschrijving"
              name="beschrijving"
              rows="4"
            ></textarea>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="longitude">Longitude *</label>
              <input
                type="number"
                id="longitude"
                [(ngModel)]="currentVoorziening.longitude"
                name="longitude"
                step="0.0001"
                required
              />
            </div>

            <div class="form-group">
              <label for="latitude">Latitude *</label>
              <input
                type="number"
                id="latitude"
                [(ngModel)]="currentVoorziening.latitude"
                name="latitude"
                step="0.0001"
                required
              />
            </div>
          </div>

          <div class="form-actions">
            <button type="button" class="btn-secondary" (click)="closeForm()">
              Cancel
            </button>
            <button type="submit" class="btn-primary" [disabled]="loading">
              {{ loading ? 'Saving...' : 'Save' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  }
</div>
